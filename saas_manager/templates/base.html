<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#714B67" />
    <meta
      name="description"
      content="Odoo SaaS Platform - Modern cloud-based ERP solution"
    />

    <title>{% block title %}Odoo SaaS Platform{% endblock %}</title>

    <!-- Preload critical resources -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      as="style"
    />
    <link
      rel="preload"
      href="{{ url_for('static', filename='css/style.css') }}"
      as="style"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />

    <!-- Custom Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Enhanced Custom CSS -->
    <link
      href="{{ url_for('static', filename='css/style.css') }}"
      rel="stylesheet"
    />

    {% block head %}{% endblock %}
  </head>

  <body>
    <!-- Enhanced Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
      <div class="container">
        <a
          class="navbar-brand float-animation"
          href="{{ url_for('dashboard') }}"
        >
          <i class="fas fa-cloud me-2"></i>
          <span>Odoo SaaS</span>
        </a>

        <button
          class="navbar-toggler border-0"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            {% if current_user.is_authenticated %}
            <li class="nav-item">
              <a
                class="nav-link"
                href="{{ url_for('dashboard') }}"
                data-tooltip="View Dashboard"
              >
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                href="{{ url_for('create_tenant') }}"
                data-tooltip="Create New Tenant"
              >
                <i class="fas fa-plus"></i>
                <span>New Tenant</span>
              </a>
            </li>
            {% if current_user.is_admin %}
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                data-tooltip="Admin Functions"
              >
                <i class="fas fa-cog"></i>
                <span>Admin</span>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('admin_tenants') }}"
                  >
                    <i class="fas fa-building"></i>
                    <span>Manage Tenants</span>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('admin_users') }}">
                    <i class="fas fa-users"></i>
                    <span>Manage Users</span>
                  </a>
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('admin_workers') }}"
                  >
                    <i class="fas fa-server"></i>
                    <span>Worker Management</span>
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('system_admin.dashboard') }}"
                  >
                    <i class="fas fa-tools"></i>
                    <span>System Admin</span>
                  </a>
                </li>
              </ul>
            </li>
            {% endif %} {% endif %}
          </ul>

          <ul class="navbar-nav">
            {% if current_user.is_authenticated %}
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                data-tooltip="User Menu"
              >
                <div class="avatar-circle me-2">
                  {{ current_user.username[0].upper() }}
                </div>
                <span>{{ current_user.username }}</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a class="dropdown-item" href="#" data-tooltip="Edit Profile">
                    <i class="fas fa-user-cog"></i>
                    <span>Profile Settings</span>
                  </a>
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    data-tooltip="Account Preferences"
                  >
                    <i class="fas fa-palette"></i>
                    <span>Preferences</span>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="#" data-tooltip="Get Help">
                    <i class="fas fa-question-circle"></i>
                    <span>Help & Support</span>
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('logout') }}"
                    data-tooltip="Sign Out"
                  >
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                  </a>
                </li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item">
              <a
                class="nav-link"
                href="{{ url_for('login') }}"
                data-tooltip="Sign In"
              >
                <i class="fas fa-sign-in-alt"></i>
                <span>Login</span>
              </a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                href="{{ url_for('register') }}"
                data-tooltip="Create Account"
              >
                <i class="fas fa-user-plus"></i>
                <span>Register</span>
              </a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Enhanced Flash Messages -->
    <div class="container mt-3" style="padding-top: 80px">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show animate-in"
        role="alert"
        style="animation-delay: {{ loop.index0 * 0.1 }}s;"
      >
        <i
          class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'info-circle' if category == 'info' else 'check-circle' if category == 'success' else 'exclamation-triangle' if category == 'warning' else 'info-circle' }} me-2"
        ></i>
        <span>{{ message }}</span>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
      {% endfor %} {% endif %} {% endwith %}
    </div>

    <!-- Main Content -->
    <main
      class="container my-4"
      style="padding-top: 60px; min-height: calc(100vh - 200px)"
    >
      {% block content %}{% endblock %}
    </main>

    <!-- Enhanced Footer -->
    <footer class="mt-5 py-5">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <div class="d-flex align-items-center mb-3 mb-md-0">
              <i class="fas fa-cloud fa-2x text-primary me-3"></i>
              <div>
                <h6 class="mb-1">Odoo SaaS Platform</h6>
                <p class="mb-0 text-muted small">
                  <i class="fas fa-copyright me-1"></i>
                  {{ moment().format('YYYY') }} All rights reserved.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="d-flex justify-content-md-end gap-4">
              <a href="#" class="text-decoration-none" data-tooltip="Get Help">
                <i class="fas fa-question-circle"></i>
                <span>Help</span>
              </a>
              <a
                href="#"
                class="text-decoration-none"
                data-tooltip="View Documentation"
              >
                <i class="fas fa-book"></i>
                <span>Documentation</span>
              </a>
              <a
                href="#"
                class="text-decoration-none"
                data-tooltip="Contact Support"
              >
                <i class="fas fa-envelope"></i>
                <span>Support</span>
              </a>
              <a
                href="#"
                class="text-decoration-none"
                data-tooltip="System Status"
              >
                <i class="fas fa-heart pulse-animation text-success"></i>
                <span>Status</span>
              </a>
            </div>
          </div>
        </div>

        <!-- Additional Footer Info -->
        <hr class="my-4" />
        <div class="row">
          <div class="col-md-8">
            <p class="small text-muted mb-0">
              Powered by modern cloud infrastructure.
              <span class="status-indicator status-healthy"></span>
              All systems operational.
              <br />
              <span class="small">
                Version 2.0 • Last updated: {{ moment().format('MMM DD, YYYY')
                }}
              </span>
            </p>
          </div>
          <div class="col-md-4 text-md-end">
            <div class="small text-muted">
              <i class="fas fa-shield-alt me-1"></i>
              Enterprise Security
              <br />
              <i class="fas fa-clock me-1"></i>
              99.9% Uptime SLA
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Back to Top Button -->
    <button
      id="back-to-top"
      class="btn btn-primary"
      style="
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: none;
        z-index: 1040;
        box-shadow: var(--shadow-lg);
        backdrop-filter: blur(10px);
      "
      data-tooltip="Back to Top"
    >
      <i class="fas fa-chevron-up"></i>
    </button>

    <!-- Scripts -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>

    <!-- Enhanced Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/style.js') }}"></script>

    <!-- Page-specific scripts -->
    {% block scripts %}{% endblock %}

    <!-- Keyboard Shortcuts Help Modal -->
    <div
      class="modal fade"
      id="shortcutsModal"
      tabindex="-1"
      aria-labelledby="shortcutsModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="shortcutsModalLabel">
              <i class="fas fa-keyboard me-2"></i>
              Keyboard Shortcuts
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-6">
                <h6><i class="fas fa-search me-2"></i>Navigation</h6>
                <ul class="list-unstyled small">
                  <li><kbd>Ctrl</kbd> + <kbd>K</kbd> - Quick Search</li>
                  <li><kbd>Ctrl</kbd> + <kbd>D</kbd> - Toggle Theme</li>
                  <li><kbd>Esc</kbd> - Close Modals</li>
                </ul>
              </div>
              <div class="col-6">
                <h6><i class="fas fa-mouse me-2"></i>Interactions</h6>
                <ul class="list-unstyled small">
                  <li>Hover for tooltips</li>
                  <li>Click & hold for ripple effects</li>
                  <li>Scroll for parallax animations</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional JavaScript for enhanced functionality -->
    <script>
      // Back to top functionality
      document.addEventListener("DOMContentLoaded", function () {
        const backToTop = document.getElementById("back-to-top");

        // Show/hide back to top button
        window.addEventListener("scroll", function () {
          if (window.pageYOffset > 300) {
            backToTop.style.display = "flex";
            backToTop.style.alignItems = "center";
            backToTop.style.justifyContent = "center";
          } else {
            backToTop.style.display = "none";
          }
        });

        // Smooth scroll to top
        backToTop.addEventListener("click", function (e) {
          e.preventDefault();
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        });

        // Add floating animation to cloud icon in footer
        document
          .querySelector("footer .fa-cloud")
          .classList.add("float-animation");

        // Enhanced navbar responsiveness
        const navbarToggler = document.querySelector(".navbar-toggler");
        const navbarCollapse = document.querySelector(".navbar-collapse");

        navbarToggler.addEventListener("click", function () {
          this.classList.toggle("active");
        });

        // Close navbar when clicking outside
        document.addEventListener("click", function (event) {
          if (
            !navbarCollapse.contains(event.target) &&
            !navbarToggler.contains(event.target)
          ) {
            if (navbarCollapse.classList.contains("show")) {
              navbarToggler.click();
            }
          }
        });

        // Add loading states to navigation links
        document.querySelectorAll(".navbar-nav a").forEach((link) => {
          if (!link.classList.contains("dropdown-toggle")) {
            link.addEventListener("click", function () {
              if (this.href && !this.href.includes("#")) {
                const icon = this.querySelector("i");
                if (icon && !icon.classList.contains("fa-spin")) {
                  icon.classList.add("fa-spinner", "fa-spin");
                  setTimeout(() => {
                    icon.classList.remove("fa-spinner", "fa-spin");
                  }, 2000);
                }
              }
            });
          }
        });

        // Enhanced form validation
        const forms = document.querySelectorAll("form");
        forms.forEach((form) => {
          form.addEventListener("submit", function (e) {
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn && this.checkValidity()) {
              submitBtn.disabled = true;
              const originalHTML = submitBtn.innerHTML;
              submitBtn.innerHTML =
                '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';

              // Re-enable after 5 seconds as fallback
              setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalHTML;
              }, 5000);
            }
          });
        });

        // Add success animations to successful operations
        const successAlerts = document.querySelectorAll(".alert-success");
        successAlerts.forEach((alert) => {
          alert.style.background =
            "linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0.05) 100%)";
          alert.style.borderLeft = "4px solid var(--success)";

          // Add confetti effect for success messages
          if (
            alert.textContent.toLowerCase().includes("success") ||
            alert.textContent.toLowerCase().includes("created") ||
            alert.textContent.toLowerCase().includes("completed")
          ) {
            createConfetti(alert);
          }
        });

        function createConfetti(element) {
          for (let i = 0; i < 15; i++) {
            const confetti = document.createElement("div");
            confetti.innerHTML = "🎉";
            confetti.style.cssText = `
              position: absolute;
              font-size: ${Math.random() * 20 + 10}px;
              left: ${Math.random() * 100}%;
              animation: confetti-fall 3s ease-out forwards;
              pointer-events: none;
              z-index: 9999;
            `;

            element.style.position = "relative";
            element.appendChild(confetti);

            setTimeout(() => confetti.remove(), 3000);
          }
        }

        // Add confetti animation
        const confettiStyles = document.createElement("style");
        confettiStyles.textContent = `
          @keyframes confetti-fall {
            0% {
              transform: translateY(-20px) rotate(0deg);
              opacity: 1;
            }
            100% {
              transform: translateY(100px) rotate(360deg);
              opacity: 0;
            }
          }
        `;
        document.head.appendChild(confettiStyles);

        // Keyboard shortcut to show shortcuts modal
        document.addEventListener("keydown", function (e) {
          if ((e.ctrlKey || e.metaKey) && e.key === "?") {
            e.preventDefault();
            const shortcutsModal = new bootstrap.Modal(
              document.getElementById("shortcutsModal")
            );
            shortcutsModal.show();
          }
        });

        // Add service worker for offline functionality
        if ("serviceWorker" in navigator) {
          navigator.serviceWorker.register("/sw.js").catch(() => {
            // Service worker registration failed, but that's okay
          });
        }

        // Add performance monitoring
        if ("performance" in window) {
          window.addEventListener("load", function () {
            setTimeout(() => {
              const perfData = performance.getEntriesByType("navigation")[0];
              if (perfData.loadEventEnd - perfData.navigationStart > 3000) {
                console.warn(
                  "Page load time is high:",
                  perfData.loadEventEnd - perfData.navigationStart,
                  "ms"
                );
              }
            }, 0);
          });
        }
      });

      // Global error handler with user-friendly messages
      window.addEventListener("error", function (e) {
        if (window.showNotification) {
          window.showNotification(
            "Something went wrong. Please try refreshing the page.",
            "error"
          );
        }
      });

      // Network status monitoring
      window.addEventListener("online", function () {
        if (window.showNotification) {
          window.showNotification("Connection restored!", "success", 3000);
        }
      });

      window.addEventListener("offline", function () {
        if (window.showNotification) {
          window.showNotification("You are currently offline.", "warning");
        }
      });
    </script>
  </body>
</html>
