<!DOCTYPE html>
<html>
  <head>
    <title>Master Admin Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
      .admin-stats {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }
      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        backdrop-filter: blur(10px);
      }
      .action-buttons {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
      }
      .tenant-health {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 5px;
      }
      .health-excellent {
        background-color: #28a745;
      }
      .health-good {
        background-color: #ffc107;
      }
      .health-poor {
        background-color: #dc3545;
      }
      .nav-tabs .nav-link.active {
        background-color: #667eea;
        border-color: #667eea;
        color: white;
      }
      .table-responsive {
        max-height: 600px;
        overflow-y: auto;
      }
      .filter-section {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .chart-container {
        position: relative;
        height: 300px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid mt-3">
      <!-- Header Stats -->
      <div class="admin-stats">
        <div class="row">
          <div class="col-md-3">
            <div class="stat-card">
              <h4><i class="fas fa-users"></i> {{ stats.total_users }}</h4>
              <p>Total Users</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <h4><i class="fas fa-building"></i> {{ stats.total_tenants }}</h4>
              <p>Total Tenants</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <h4>
                <i class="fas fa-check-circle"></i> {{ stats.active_tenants }}
              </h4>
              <p>Active Tenants</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <h4>
                <i class="fas fa-dollar-sign"></i> ${{ stats.total_revenue }}
              </h4>
              <p>Monthly Revenue</p>
            </div>
          </div>
        </div>
      </div>

      <h1><i class="fas fa-crown"></i> Master Admin Control Center</h1>

      <!-- Navigation Tabs -->
      <ul class="nav nav-tabs" id="adminTabs" role="tablist">
        <li class="nav-item">
          <a
            class="nav-link active"
            id="overview-tab"
            data-bs-toggle="tab"
            href="#overview"
            role="tab"
          >
            <i class="fas fa-tachometer-alt"></i> Overview
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="users-tab"
            data-bs-toggle="tab"
            href="#users"
            role="tab"
          >
            <i class="fas fa-users"></i> Users Management
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="tenants-tab"
            data-bs-toggle="tab"
            href="#tenants"
            role="tab"
          >
            <i class="fas fa-building"></i> Tenants Management
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="analytics-tab"
            data-bs-toggle="tab"
            href="#analytics"
            role="tab"
          >
            <i class="fas fa-chart-bar"></i> Analytics
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="operations-tab"
            data-bs-toggle="tab"
            href="#operations"
            role="tab"
          >
            <i class="fas fa-cogs"></i> Operations
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="security-tab"
            data-bs-toggle="tab"
            href="#security"
            role="tab"
          >
            <i class="fas fa-shield-alt"></i> Security
          </a>
        </li>
      </ul>
      <div class="tab-content" id="adminTabContent">
        <!-- Overview Tab -->
        <div class="tab-pane fade show active" id="overview" role="tabpanel">
          <div class="row mt-4">
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-chart-line"></i> User Growth</h5>
                </div>
                <div class="card-body">
                  <div class="chart-container">
                    <canvas id="userGrowthChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-chart-pie"></i> Tenant Distribution</h5>
                </div>
                <div class="card-body">
                  <div class="chart-container">
                    <canvas id="tenantDistributionChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-4">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header">
                  <h5>
                    <i class="fas fa-exclamation-triangle"></i> System Alerts
                  </h5>
                </div>
                <div class="card-body">
                  <div class="alert alert-warning" role="alert">
                    <i class="fas fa-database"></i> Database backup scheduled
                    for tonight at 2 AM
                  </div>
                  <div class="alert alert-info" role="alert">
                    <i class="fas fa-update"></i> System update available -
                    Version 2.1.0
                  </div>
                  <div class="alert alert-danger" role="alert">
                    <i class="fas fa-server"></i> Server disk usage at 85% -
                    Consider cleanup
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Users Management Tab -->
        <div class="tab-pane fade" id="users" role="tabpanel">
          <div class="filter-section">
            <div class="row">
              <div class="col-md-3">
                <input
                  type="text"
                  class="form-control"
                  id="userSearch"
                  placeholder="Search users..."
                  onkeyup="filterUsers()"
                />
              </div>
              <div class="col-md-2">
                <select
                  class="form-select"
                  id="userStatusFilter"
                  onchange="filterUsers()"
                >
                  <option value="">All Status</option>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>
              <div class="col-md-2">
                <select
                  class="form-select"
                  id="userAdminFilter"
                  onchange="filterUsers()"
                >
                  <option value="">All Users</option>
                  <option value="admin">Admins Only</option>
                  <option value="user">Regular Users</option>
                </select>
              </div>
              <div class="col-md-3">
                <button class="btn btn-success" onclick="exportUsers()">
                  <i class="fas fa-download"></i> Export Users
                </button>
                <button class="btn btn-primary" onclick="bulkActions()">
                  <i class="fas fa-tasks"></i> Bulk Actions
                </button>
              </div>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-striped table-hover" id="usersTable">
              <thead class="table-dark">
                <tr>
                  <th>
                    <input
                      type="checkbox"
                      id="selectAllUsers"
                      onchange="toggleAllUsers()"
                    />
                  </th>
                  <th>Username</th>
                  <th>Email</th>
                  <th>Admin</th>
                  <th>Status</th>
                  <th>Last Login</th>
                  <th>Tenants</th>
                  <th>Registration</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for user in users %}
                <tr>
                  <td>
                    <input
                      type="checkbox"
                      class="user-checkbox"
                      value="{{ user.id }}"
                    />
                  </td>
                  <td>
                    <strong>{{ user.username }}</strong>
                    {% if user.is_admin %}
                    <span class="badge bg-primary">ADMIN</span>
                    {% endif %}
                  </td>
                  <td>{{ user.email }}</td>
                  <td>
                    <span
                      class="badge bg-{{ 'success' if user.is_admin else 'secondary' }}"
                    >
                      {{ 'Yes' if user.is_admin else 'No' }}
                    </span>
                  </td>
                  <td>
                    <span
                      class="badge bg-{{ 'success' if user.is_active else 'danger' }}"
                    >
                      {{ 'Active' if user.is_active else 'Inactive' }}
                    </span>
                  </td>
                  <td>{{ user.last_login or 'Never' }}</td>
                  <td>
                    <span class="badge bg-info">{{ user.tenant_count }}</span>
                    {% for tenant in user.tenants %}
                    <small class="d-block"
                      >{{ tenant.name }} ({{ tenant.subdomain }})</small
                    >
                    {% endfor %}
                  </td>
                  <td>{{ user.created_at }}</td>
                  <td>
                    <div class="action-buttons">
                      <button
                        class="btn btn-sm btn-{{ 'danger' if user.is_active else 'success' }}"
                        onclick="toggleUserStatus({{ user.id }})"
                      >
                        <i
                          class="fas fa-{{ 'ban' if user.is_active else 'check' }}"
                        ></i>
                        {{ 'Deactivate' if user.is_active else 'Activate' }}
                      </button>
                      <button
                        class="btn btn-sm btn-warning"
                        onclick="resetUserPassword({{ user.id }})"
                      >
                        <i class="fas fa-key"></i> Reset Password
                      </button>
                      <button
                        class="btn btn-sm btn-info"
                        onclick="viewUserDetails({{ user.id }})"
                      >
                        <i class="fas fa-eye"></i> Details
                      </button>
                      <button
                        class="btn btn-sm btn-secondary"
                        onclick="impersonateUser({{ user.id }})"
                      >
                        <i class="fas fa-user-secret"></i> Impersonate
                      </button>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tenants Management Tab -->
        <div class="tab-pane fade" id="tenants" role="tabpanel">
          <div class="filter-section">
            <div class="row">
              <div class="col-md-3">
                <input
                  type="text"
                  class="form-control"
                  id="tenantSearch"
                  placeholder="Search tenants..."
                  onkeyup="filterTenants()"
                />
              </div>
              <div class="col-md-2">
                <select
                  class="form-select"
                  id="tenantStatusFilter"
                  onchange="filterTenants()"
                >
                  <option value="">All Status</option>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                  <option value="suspended">Suspended</option>
                </select>
              </div>
              <div class="col-md-2">
                <select
                  class="form-select"
                  id="tenantPlanFilter"
                  onchange="filterTenants()"
                >
                  <option value="">All Plans</option>
                  <option value="basic">Basic</option>
                  <option value="pro">Pro</option>
                  <option value="enterprise">Enterprise</option>
                </select>
              </div>
              <div class="col-md-3">
                <button class="btn btn-success" onclick="exportTenants()">
                  <i class="fas fa-download"></i> Export Tenants
                </button>
                <button class="btn btn-primary" onclick="bulkTenantActions()">
                  <i class="fas fa-tasks"></i> Bulk Actions
                </button>
              </div>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-striped table-hover" id="tenantsTable">
              <thead class="table-dark">
                <tr>
                  <th>
                    <input
                      type="checkbox"
                      id="selectAllTenants"
                      onchange="toggleAllTenants()"
                    />
                  </th>
                  <th>Name</th>
                  <th>Subdomain</th>
                  <th>Status</th>
                  <th>Plan</th>
                  <th>Health</th>
                  <th>Storage</th>
                  <th>Users</th>
                  <th>Revenue</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for tenant in tenants %}
                <tr>
                  <td>
                    <input
                      type="checkbox"
                      class="tenant-checkbox"
                      value="{{ tenant.id }}"
                    />
                  </td>
                  <td>
                    <strong>{{ tenant.name }}</strong>
                    <small class="d-block text-muted"
                      >{{ tenant.created_at }}</small
                    >
                  </td>
                  <td>
                    <a
                      href="https://{{ tenant.subdomain }}.yourdomain.com"
                      target="_blank"
                    >
                      {{ tenant.subdomain }}
                    </a>
                  </td>
                  <td>
                    <span
                      class="badge bg-{{ 'success' if tenant.status == 'active' else 'danger' if tenant.status == 'suspended' else 'warning' }}"
                    >
                      {{ tenant.status.upper() }}
                    </span>
                  </td>
                  <td>
                    <span class="badge bg-primary"
                      >{{ tenant.plan.upper() }}</span
                    >
                  </td>
                  <td>
                    <span
                      class="tenant-health health-{{ tenant.health }}"
                    ></span>
                    {{ tenant.health.title() }}
                  </td>
                  <td>
                    <small>{{ tenant.storage_usage }}</small>
                    <div class="progress" style="height: 5px">
                      <div
                        class="progress-bar"
                        style="width: {{ tenant.storage_percentage }}%"
                      ></div>
                    </div>
                  </td>
                  <td>
                    <span class="badge bg-info">{{ tenant.user_count }}</span>
                  </td>
                  <td>
                    <strong>${{ tenant.monthly_revenue }}</strong>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <button
                        class="btn btn-sm btn-{{ 'danger' if tenant.status == 'active' else 'success' }}"
                        onclick="toggleTenantStatus({{ tenant.id }})"
                      >
                        <i
                          class="fas fa-{{ 'stop' if tenant.status == 'active' else 'play' }}"
                        ></i>
                        {{ 'Disable' if tenant.status == 'active' else 'Enable'
                        }}
                      </button>
                      <button
                        class="btn btn-sm btn-warning"
                        onclick="suspendTenant({{ tenant.id }})"
                      >
                        <i class="fas fa-pause"></i> Suspend
                      </button>
                      <button
                        class="btn btn-sm btn-info"
                        onclick="viewTenantDetails({{ tenant.id }})"
                      >
                        <i class="fas fa-eye"></i> Details
                      </button>
                      <button
                        class="btn btn-sm btn-secondary"
                        onclick="backupTenant({{ tenant.id }})"
                      >
                        <i class="fas fa-download"></i> Backup
                      </button>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <!-- Analytics Tab -->
        <div class="tab-pane fade" id="analytics" role="tabpanel">
          <div class="row mt-4">
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-chart-bar"></i> Revenue Analytics</h5>
                </div>
                <div class="card-body">
                  <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-chart-area"></i> Storage Usage</h5>
                </div>
                <div class="card-body">
                  <div class="chart-container">
                    <canvas id="storageChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-4">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-table"></i> Detailed Analytics</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-3">
                      <div class="card text-center">
                        <div class="card-body">
                          <h4 class="text-primary">
                            {{ analytics.total_users }}
                          </h4>
                          <p>Total Users</p>
                          <small class="text-success"
                            >+{{ analytics.new_users_today }} today</small
                          >
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="card text-center">
                        <div class="card-body">
                          <h4 class="text-success">
                            {{ analytics.active_tenants }}
                          </h4>
                          <p>Active Tenants</p>
                          <small class="text-info"
                            >{{ analytics.tenant_uptime }}% uptime</small
                          >
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="card text-center">
                        <div class="card-body">
                          <h4 class="text-warning">
                            {{ analytics.total_storage }}
                          </h4>
                          <p>Total Storage</p>
                          <small class="text-danger"
                            >{{ analytics.storage_growth }}% growth</small
                          >
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="card text-center">
                        <div class="card-body">
                          <h4 class="text-info">
                            ${{ analytics.monthly_revenue }}
                          </h4>
                          <p>Monthly Revenue</p>
                          <small class="text-success"
                            >+{{ analytics.revenue_growth }}% from last
                            month</small
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Operations Tab -->
        <div class="tab-pane fade" id="operations" role="tabpanel">
          <div class="row mt-4">
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-database"></i> Database Operations</h5>
                </div>
                <div class="card-body">
                  <button
                    class="btn btn-primary mb-2"
                    onclick="performDatabaseBackup()"
                  >
                    <i class="fas fa-download"></i> Full System Backup</button
                  ><br />
                  <button
                    class="btn btn-warning mb-2"
                    onclick="performDatabaseOptimization()"
                  >
                    <i class="fas fa-wrench"></i> Optimize Database</button
                  ><br />
                  <button
                    class="btn btn-info mb-2"
                    onclick="performDatabaseCleanup()"
                  >
                    <i class="fas fa-broom"></i> Clean Database</button
                  ><br />
                  <button
                    class="btn btn-success mb-2"
                    onclick="performDatabaseMigration()"
                  >
                    <i class="fas fa-sync"></i> Run Migrations
                  </button>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-cogs"></i> System Operations</h5>
                </div>
                <div class="card-body">
                  <button
                    class="btn btn-primary mb-2"
                    onclick="clearSystemCache()"
                  >
                    <i class="fas fa-trash"></i> Clear Cache</button
                  ><br />
                  <button
                    class="btn btn-warning mb-2"
                    onclick="restartServices()"
                  >
                    <i class="fas fa-redo"></i> Restart Services</button
                  ><br />
                  <button class="btn btn-info mb-2" onclick="updateSystem()">
                    <i class="fas fa-upload"></i> Update System</button
                  ><br />
                  <button
                    class="btn btn-success mb-2"
                    onclick="performHealthCheck()"
                  >
                    <i class="fas fa-heartbeat"></i> Health Check
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-4">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-list"></i> System Logs</h5>
                </div>
                <div class="card-body">
                  <div class="table-responsive" style="max-height: 300px">
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th>Timestamp</th>
                          <th>Level</th>
                          <th>Message</th>
                          <th>User</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>2024-01-15 10:30:00</td>
                          <td><span class="badge bg-success">INFO</span></td>
                          <td>System backup completed successfully</td>
                          <td>system</td>
                        </tr>
                        <tr>
                          <td>2024-01-15 10:25:00</td>
                          <td><span class="badge bg-warning">WARN</span></td>
                          <td>High memory usage detected</td>
                          <td>system</td>
                        </tr>
                        <tr>
                          <td>2024-01-15 10:20:00</td>
                          <td><span class="badge bg-danger">ERROR</span></td>
                          <td>Database connection timeout</td>
                          <td>system</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Security Tab -->
        <div class="tab-pane fade" id="security" role="tabpanel">
          <div class="row mt-4">
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-shield-alt"></i> Security Alerts</h5>
                </div>
                <div class="card-body">
                  <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle"></i>
                    5 failed login attempts detected from IP: 192.168.1.100
                  </div>
                  <div class="alert alert-warning">
                    <i class="fas fa-key"></i>
                    Password policy violations: 3 users with weak passwords
                  </div>
                  <div class="alert alert-info">
                    <i class="fas fa-clock"></i>
                    2 users haven't logged in for 90+ days
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-ban"></i> IP Blocking</h5>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">Block IP Address</label>
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter IP address"
                      />
                      <button class="btn btn-danger" onclick="blockIP()">
                        <i class="fas fa-ban"></i> Block
                      </button>
                    </div>
                  </div>
                  <div class="table-responsive" style="max-height: 200px">
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th>IP Address</th>
                          <th>Blocked At</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>192.168.1.100</td>
                          <td>2024-01-15 10:30:00</td>
                          <td>
                            <button
                              class="btn btn-sm btn-success"
                              onclick="unblockIP('192.168.1.100')"
                            >
                              <i class="fas fa-check"></i> Unblock
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initialize Charts
      function initCharts() {
        // User Growth Chart
          const userGrowthCtx = document.getElementById("userGrowthChart").getContext("2d");
          const userGrowthData = {{ analytics.users_per_month | tojson }};
          new Chart(userGrowthCtx, {
            type: "line",
            data: {
              labels: Object.keys(userGrowthData),
              datasets: [
                {
                  label: "Users",
                  data: Object.values(userGrowthData),
                  borderColor: "#667eea",
                  backgroundColor: "rgba(102, 126, 234, 0.1)",
                  fill: true,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: "Number of Users",
                  },
                },
                x: {
                  title: {
                    display: true,
                    text: "Month",
                  },
                },
              },
            },
          });
        // Tenant Distribution Chart
        const tenantDistCtx = document
          .getElementById("tenantDistributionChart")
          .getContext("2d");
          const tenantDistData = {{ analytics.plan_usage | tojson }};
        new Chart(tenantDistCtx, {
          type: "doughnut",
          data: {
            labels: Object.keys(tenantDistData),
            datasets: [
              {
                data: Object.values(tenantDistData),
                backgroundColor: ["#28a745", "#ffc107", "#dc3545"],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
          },
        });

        // Revenue Chart
        const revenueCtx = document
          .getElementById("revenueChart")
          .getContext("2d");
        new Chart(revenueCtx, {
          type: "bar",
          data: {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
            datasets: [
              {
                label: "Revenue",
                data: [1200, 1800, 2400, 3200, 4100, 5000],
                backgroundColor: "#667eea",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
          },
        });

        // Storage Chart
        const storageCtx = document
          .getElementById("storageChart")
          .getContext("2d");
        new Chart(storageCtx, {
          type: "line",
          data: {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
            datasets: [
              {
                label: "Storage (GB)",
                data: [50, 75, 100, 140, 180, 220],
                borderColor: "#28a745",
                backgroundColor: "rgba(40, 167, 69, 0.1)",
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
          },
        });
      }

      // User Management Functions
      function toggleUserStatus(userId) {
        if (confirm("Are you sure you want to change this user's status?")) {
          fetch(`/master-admin/user/${userId}/toggle_status`, {
            method: "POST",
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                location.reload();
              } else {
                alert(data.message);
              }
            });
        }
      }

      function resetUserPassword(userId) {
        if (confirm("Are you sure you want to reset this user's password?")) {
          fetch(`/master-admin/user/${userId}/reset_password`, {
            method: "POST",
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert(
                  `Password reset successfully. New password: ${data.new_password}`
                );
              } else {
                alert(data.message);
              }
            });
        }
      }

      function viewUserDetails(userId) {
        window.open(`/master-admin/user/${userId}/details`, "_blank");
      }

      function impersonateUser(userId) {
        if (confirm("Are you sure you want to impersonate this user?")) {
          fetch(`/master-admin/user/${userId}/impersonate`, { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                window.open(data.redirect_url, "_blank");
              } else {
                alert(data.message);
              }
            });
        }
      }

      function filterUsers() {
        const searchTerm = document
          .getElementById("userSearch")
          .value.toLowerCase();
        const statusFilter = document.getElementById("userStatusFilter").value;
        const adminFilter = document.getElementById("userAdminFilter").value;
        const table = document.getElementById("usersTable");
        const rows = table
          .getElementsByTagName("tbody")[0]
          .getElementsByTagName("tr");

        for (let i = 0; i < rows.length; i++) {
          const row = rows[i];
          const username = row.cells[1].textContent.toLowerCase();
          const email = row.cells[2].textContent.toLowerCase();
          const status = row.cells[4].textContent.toLowerCase();
          const isAdmin = row.cells[3].textContent.toLowerCase() === "yes";

          let showRow = true;

          // Text search
          if (
            searchTerm &&
            !username.includes(searchTerm) &&
            !email.includes(searchTerm)
          ) {
            showRow = false;
          }

          // Status filter
          if (statusFilter && !status.includes(statusFilter)) {
            showRow = false;
          }

          // Admin filter
          if (adminFilter === "admin" && !isAdmin) {
            showRow = false;
          } else if (adminFilter === "user" && isAdmin) {
            showRow = false;
          }

          row.style.display = showRow ? "" : "none";
        }
      }

      function toggleAllUsers() {
        const checkboxes = document.querySelectorAll(".user-checkbox");
        const selectAll = document.getElementById("selectAllUsers");
        checkboxes.forEach(
          (checkbox) => (checkbox.checked = selectAll.checked)
        );
      }

      function exportUsers() {
        window.open("/master-admin/export/users", "_blank");
      }

      function bulkActions() {
        const selected = Array.from(
          document.querySelectorAll(".user-checkbox:checked")
        ).map((cb) => cb.value);
        if (selected.length === 0) {
          alert("Please select users first");
          return;
        }

        const action = prompt("Enter action (activate/deactivate/delete):");
        if (
          action &&
          confirm(
            `Are you sure you want to ${action} ${selected.length} users?`
          )
        ) {
          fetch("/master-admin/users/bulk_action", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ action, user_ids: selected }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                location.reload();
              } else {
                alert(data.message);
              }
            });
        }
      }

      // Tenant Management Functions
      function toggleTenantStatus(tenantId) {
        if (confirm("Are you sure you want to change this tenant's status?")) {
          fetch(`/master-admin/tenant/${tenantId}/toggle_status`, {
            method: "POST",
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                location.reload();
              } else {
                alert(data.message);
              }
            });
        }
      }

      function suspendTenant(tenantId) {
        if (confirm("Are you sure you want to suspend this tenant?")) {
          fetch(`/master-admin/tenant/${tenantId}/suspend`, { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                location.reload();
              } else {
                alert(data.message);
              }
            });
        }
      }

      function viewTenantDetails(tenantId) {
        window.open(`/master-admin/tenant/${tenantId}/details`, "_blank");
      }

      function backupTenant(tenantId) {
        if (confirm("Are you sure you want to backup this tenant?")) {
          fetch(`/master-admin/tenant/${tenantId}/backup`, { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("Backup initiated successfully");
              } else {
                alert(data.message);
              }
            });
        }
      }

      function filterTenants() {
        const searchTerm = document
          .getElementById("tenantSearch")
          .value.toLowerCase();
        const statusFilter =
          document.getElementById("tenantStatusFilter").value;
        const planFilter = document.getElementById("tenantPlanFilter").value;
        const table = document.getElementById("tenantsTable");
        const rows = table
          .getElementsByTagName("tbody")[0]
          .getElementsByTagName("tr");

        for (let i = 0; i < rows.length; i++) {
          const row = rows[i];
          const name = row.cells[1].textContent.toLowerCase();
          const subdomain = row.cells[2].textContent.toLowerCase();
          const status = row.cells[3].textContent.toLowerCase();
          const plan = row.cells[4].textContent.toLowerCase();

          let showRow = true;

          // Text search
          if (
            searchTerm &&
            !name.includes(searchTerm) &&
            !subdomain.includes(searchTerm)
          ) {
            showRow = false;
          }

          // Status filter
          if (statusFilter && !status.includes(statusFilter)) {
            showRow = false;
          }

          // Plan filter
          if (planFilter && !plan.includes(planFilter)) {
            showRow = false;
          }

          row.style.display = showRow ? "" : "none";
        }
      }

      function toggleAllTenants() {
        const checkboxes = document.querySelectorAll(".tenant-checkbox");
        const selectAll = document.getElementById("selectAllTenants");
        checkboxes.forEach(
          (checkbox) => (checkbox.checked = selectAll.checked)
        );
      }

      function exportTenants() {
        window.open("/master-admin/export/tenants", "_blank");
      }

      function bulkTenantActions() {
        const selected = Array.from(
          document.querySelectorAll(".tenant-checkbox:checked")
        ).map((cb) => cb.value);
        if (selected.length === 0) {
          alert("Please select tenants first");
          return;
        }

        const action = prompt(
          "Enter action (activate/deactivate/suspend/backup):"
        );
        if (
          action &&
          confirm(
            `Are you sure you want to ${action} ${selected.length} tenants?`
          )
        ) {
          fetch("/master-admin/tenants/bulk_action", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ action, tenant_ids: selected }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                location.reload();
              } else {
                alert(data.message);
              }
            });
        }
      }

      // Operations Functions
      function performDatabaseBackup() {
        if (confirm("Are you sure you want to perform a full system backup?")) {
          fetch("/master-admin/operations/database_backup", { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("Database backup initiated successfully");
              } else {
                alert(data.message);
              }
            });
        }
      }

      function performDatabaseOptimization() {
        if (confirm("Are you sure you want to optimize the database?")) {
          fetch("/master-admin/operations/database_optimize", {
            method: "POST",
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("Database optimization completed");
              } else {
                alert(data.message);
              }
            });
        }
      }

      function performDatabaseCleanup() {
        if (confirm("Are you sure you want to clean the database?")) {
          fetch("/master-admin/operations/database_cleanup", { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("Database cleanup completed");
              } else {
                alert(data.message);
              }
            });
        }
      }

      function performDatabaseMigration() {
        if (confirm("Are you sure you want to run database migrations?")) {
          fetch("/master-admin/operations/database_migrate", { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("Database migrations completed");
              } else {
                alert(data.message);
              }
            });
        }
      }

      function clearSystemCache() {
        if (confirm("Are you sure you want to clear system cache?")) {
          fetch("/master-admin/operations/clear_cache", { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("System cache cleared successfully");
              } else {
                alert(data.message);
              }
            });
        }
      }

      function restartServices() {
        if (confirm("Are you sure you want to restart services?")) {
          fetch("/master-admin/operations/restart_services", { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("Services restarted successfully");
              } else {
                alert(data.message);
              }
            });
        }
      }

      function updateSystem() {
        if (confirm("Are you sure you want to update the system?")) {
          fetch("/master-admin/operations/update_system", { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("System update initiated");
              } else {
                alert(data.message);
              }
            });
        }
      }

      function performHealthCheck() {
        fetch("/master-admin/operations/health_check", { method: "POST" })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert(
                `Health Check Results:\n${JSON.stringify(
                  data.results,
                  null,
                  2
                )}`
              );
            } else {
              alert(data.message);
            }
          });
      }

      // Security Functions
      function blockIP() {
        const ipInput = document.querySelector(
          'input[placeholder="Enter IP address"]'
        );
        const ip = ipInput.value.trim();

        if (!ip) {
          alert("Please enter an IP address");
          return;
        }

        if (confirm(`Are you sure you want to block IP: ${ip}?`)) {
          fetch("/master-admin/security/block_ip", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ip_address: ip }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("IP blocked successfully");
                location.reload();
              } else {
                alert(data.message);
              }
            });
        }
      }

      function unblockIP(ip) {
        if (confirm(`Are you sure you want to unblock IP: ${ip}?`)) {
          fetch("/master-admin/security/unblock_ip", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ip_address: ip }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("IP unblocked successfully");
                location.reload();
              } else {
                alert(data.message);
              }
            });
        }
      }

      // Initialize everything when page loads
      document.addEventListener("DOMContentLoaded", function () {
        initCharts();
      });
    </script>
  </body>
</html>
